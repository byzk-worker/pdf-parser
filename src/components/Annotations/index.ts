import { PDFDocumentProxy, PDFPageProxy, PDFDateString } from "pdfjs-dist";
import styles from "./index.module.less";

import { PageComponentAttachInterface, PagesComponent } from "../Pages";
import { base64ToBlob, dateFormat } from "../../utils";

import { createAnnotationEle } from "../../views/AnnotationView";

const jiantouUrl = window.URL.createObjectURL(
  base64ToBlob(
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAACV5JREFUeF7tnceOHFUUho833iB5yQKW7ACBBEJesfALIFjAC4DEMxgWwAYeAh4AyeRgcs45GpNzzjknXfmO7RlPd9U9dar6rz5fr++p/u/31+c7PdPu3mE8IACBhQR2wAYCEFhMAEG4OyCwhACCcHtAAEG4ByDgI8AJ4uPGVBICCJKkaLbpI4AgPm5MJSGAIEmKZps+Agji48ZUEgIIkqRotukjgCA+bkwlIYAgSYpmmz4CCOLjxlQSAgiSpGi26SOAID5uTCUhgCBJimabPgII4uPGVBICCJKkaLbpI4AgPm5MJSGAIEmKZps+Agji48ZUEgIIkqRotukjgCA+bkwlIYAgSYpmmz4CCOLjxlQSAgiSpGi26SOAID5uTCUhgCBJimabPgII4uPGVBICCJKkaLbpI4AgPm5MJSGAIEmKZps+Agji48ZUEgIIkqRotukjgCA+bkwlIYAgSYpmmz4CCOLjxlQSAgiSpGi26SOAID5uTCUhgCBJimabPgII4uPGVBICCJKkaLbpI4AgPm5MJSGAIEmKZps+Agji48ZUEgIIkqRotukjgCA+bkwlIYAgSYpmmz4CCOLjxlQSAgiSpGi26SOAID5uTCUhgCBJimabPgII4uPGVBICCJKkaLbpI4AgPm5MJSGAIEmKZps+Agji48ZUEgIIkqRotukjgCA+bkwlIYAgSYpmmz4CCOLjxlQSAgiSpGi26SOAID5uTCUhgCBJimabPgII4uPGVBICCJKkaLbpI4AgPm5MJSEwN0GON7PTzew0M3vBzB4xs7+SdKW8zTPM7HMz+1Q5pCfbnAS5yMyu3rLJr8zsWjO7shbkYcCMj8BuM9trZnvMbFe9xNtmdr+ZXey7pN7UXAS52czOWYKvFHOJme3TQ7yWiS6vcuxcsruTzezg3Hc/B0FKGZf1BH2+mV3Xcy3LfAT69nHAzE71PYXOlLogx5nZm2Z2Qk9k/5lZkeT6nutZ1kagrxwbVy3rr2h7Cq3V6oKcZWZPNyL7t0pyQ+Mcy5cTaJWjXO3Wjh+N5ZmrC3KhmV3joPhPleRGxywjxxLwyFGuUn6rdeKcga6rIKWTv6skN825IIHsXjkQZILyPD9iHR2r/I2kvCYpvwXj0U5giBz8iNXOu3mivEh/ycxOap48MvBnleSWAdfIODpUjsKMF+kT3DnnmdnQF9x/VEnKi0Ye3QQi5HjKzM6e+zsd1F+DbFQZUdjvVZLbuu+P1CsiWJdft59rZrM/teciyMZx3fcPhovu8N+qJLenVmDx5qPkuGBd/mA7J0GiJPm1SrIfSTYRQI5tboi5CRIlyS9mVv6VQ5JDNwVyLPjXco6CRBX6c5XkjuQnCXIsuQHmKkiUJD9VSe5MKglydBQ/Z0GiJPmxSnJXMkmQo0fhcxckSpIfqiR392C2DkuQo2eL6yBIlCTfV0nu6clursuQo6G5dREkSpLvqiT3NjCc01LkaGxrnQSJlKS8wfG+Rpbqy5HD0dC6CRIlybf1j4nlAwjW4YEczhbXUZAoSb6pkjzgZKsyhhwDmlhXQaIk+bpK8uAAxqscjZCj5E/7YRjrLEiUJOWzt8oN8tAq73THcyOHA9rWkXUXJEqSL6skDwcwn+ISyBFEOYMgUZJ8USUpH3eq/ECOwHayCBIlSfn82fLj1qOBHUReCjkiaZpZJkGiJPmsSvJYcBdDL4ccQwluM59NkChJyuc9lZPk8RE68VwSOTzUesxkFCRKkk+qJE/04DzmEuQYkW5WQaIk+bhK8uSIHS27NHKMDD6zIFGSfFQlKR9zM+UDOSagnV2QKEk+rJK0ftC2t2Lk8JJrnEOQQ8AibrgP6lvlx5YkImvZc9q3j7Q4giBHaEXceO9XSZ5pKaFhbURG5GgAjiCbYUXcgEWS8q/zsw099FkakQ05+pA+ag2CHAss4kZ8r0ryXGMfi5ZHZEIORxkIsj20iBvy3SrJ845ejh6JyIIczhIQZDG4iBvznSpJ+U53zyMiA3J4yNcZBFkOL+IGLV9RXV6TvNjYU8RzI0cj9K3LEaQbYMSN+laVpHwZUJ9HxHMiRx/SHWsQpB/EiBu2fJ11OUle7njKiOdCjn69dq5CkE5EhxdE3LhvVEleWfC0Ec+BHP077VyJIJ2INi2IuIFfr5K8uuWpI66NHG19dq5GkE5ExyyIuJEPVkkO1KtHXBM52rvsnECQTkTbLoi4oV+rkpQv8hn61XLI4euxcwpBOhEtXBAhSTlBTvFHODzJGw8DIG53CQQZBjZCkmEJeFfuUH5L5xFkON5VSsLJMbw/BBmZYbn8KiRBjgmK5QSJgzylJMgR1xsnyEQspzpJkGPCQjlB4mGPeZIgR3xfnCATMx3rJEGOFRTJCTIe9MiTBDnG64kTZEVso04S5FhhgZwg48MfcpIgx/j9cIKsmLH3JEEOgeI4QaYroeUkQY7peuEEEWG9cZLsNbOdCzKV/5p7qZntE8qcOgonyPT17zazIskeM9tVn758sMN+M7vKzMq3WPEQIYAgqy3iTDMr31hVvpCHhyABBBEshUg6BBBEpwuSCBJAEMFSiKRDAEF0uiCJIAEEESyFSDoEEESnC5IIEkAQwVKIpEMAQXS6IIkgAQQRLIVIOgQQRKcLkggSQBDBUoikQwBBdLogiSABBBEshUg6BBBEpwuSCBJAEMFSiKRDAEF0uiCJIAEEESyFSDoEEESnC5IIEkAQwVKIpEMAQXS6IIkgAQQRLIVIOgQQRKcLkggSQBDBUoikQwBBdLogiSABBBEshUg6BBBEpwuSCBJAEMFSiKRDAEF0uiCJIAEEESyFSDoEEESnC5IIEkAQwVKIpEMAQXS6IIkgAQQRLIVIOgQQRKcLkggSQBDBUoikQwBBdLogiSABBBEshUg6BBBEpwuSCBJAEMFSiKRDAEF0uiCJIAEEESyFSDoEEESnC5IIEkAQwVKIpEMAQXS6IIkgAQQRLIVIOgQQRKcLkggSQBDBUoikQwBBdLogiSABBBEshUg6BBBEpwuSCBJAEMFSiKRDAEF0uiCJIAEEESyFSDoEEESnC5IIEkAQwVKIpEMAQXS6IIkgAQQRLIVIOgQQRKcLkggSQBDBUoikQwBBdLogiSABBBEshUg6BBBEpwuSCBJAEMFSiKRDAEF0uiCJIAEEESyFSDoEEESnC5IIEkAQwVKIpEMAQXS6IIkggf8BtgYi2IZj8RUAAAAASUVORK5CYII="
  )
);

const infoUrl = window.URL.createObjectURL(
  base64ToBlob(
    "data:image/png;base64,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"
  )
);

export class AnnotationsComponent implements PageComponentAttachInterface {
  private _wrapperEle = document.createElement("div");
  public constructor(
    private _pageComponent: PagesComponent,
    private _getScale: () => number
  ) {
    this._wrapperEle.className = styles.annotations;
  }

  private _setttingTextLine(
    textLineEle: any,
    desc: string,
    content: string
  ): HTMLElement {
    if (!desc.endsWith(":")) {
      desc += ":";
    }
    const targetEle = textLineEle.cloneNode(true) as HTMLElement;
    (targetEle.children[0] as any).innerText = desc;
    (targetEle.children[1] as any).innerText = content;
    targetEle.title = desc + " " + content;
    return targetEle;
  }

  attachRunInit(): boolean {
    return true;
  }

  async attach(
    doc: PDFDocumentProxy,
    page: PDFPageProxy,
    pageWrapperEle: HTMLDivElement,
    pageCanvas: HTMLCanvasElement,
    pageIndex: number
  ): Promise<void> {
    if (pageIndex === 1) {
      this._wrapperEle.innerHTML = "";
    }
    const annotations = await page.getAnnotations();
    annotations.forEach((annotation) => {
      if (annotation.subtype !== "FreeText") {
        return;
      }

      const textLineList: { desc: string; content: string }[] = [
        {
          desc: "注释类型",
          content: "文本",
        },
      ];

      if (annotation.modificationDate) {
        const modificationDate = PDFDateString.toDateObject(
          annotation.modificationDate
        );
        textLineList.push({
          desc: "注释时间",
          content: dateFormat(modificationDate, "yyyy-MM-dd hh:mm:ss"),
        });
      }

      textLineList.push({
        desc: "注释位置",
        content: `第${pageIndex}页`,
      });

      this._wrapperEle.appendChild(
        createAnnotationEle(
          annotation.rect,
          pageIndex,
          this._getScale,
          this._pageComponent,
          {
            jiantouUrl,
            infoIconUrl: infoUrl,
            titleContent: "由 “” 注释",
          },
          textLineList
        )
      );
    });
  }

  public render(ele: HTMLElement) {
    ele.innerHTML = "";
    ele.appendChild(this._wrapperEle);
  }
}
